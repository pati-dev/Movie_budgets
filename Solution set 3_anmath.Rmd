---
title: "Solution set 3"
author: "Ankit Mathur"
date: "2/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
library(tidyverse)
library(GGally)
library(broom)
cb_palette = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Solution 1

```{r, include=FALSE}
# Load the data
movies = read.csv("movie_budgets.txt", sep = " ")
```

```{r, include=FALSE}
# Transform movie budgets to log scale
movies$log_budget <- log10(movies$budget)
```

```{r, include=FALSE}
# Plot *ggpairs* for all 3 vars
ggpairs(movies, columns = c("log_budget", "length", "year"))
```

```{r, include=FALSE}
## Color trivariate plots by year
# unique(movies[order(movies$year), "year"])
# names(movies)
fac_year = rep(NA, nrow(movies))
fac_year[movies$year < 1960] = "1906-1960"
fac_year[movies$year >= 1960] = "1960-2005"
movies2 = data.frame(movies, fac_year)
ggpairs(movies2, columns = c("log_budget", "length", "year"), aes(color = fac_year))
```

```{r, include=FALSE}
# Color trivariate plots by length
fac_length = rep(NA, nrow(movies))
fac_length[movies$length < 100] = "short"
fac_length[movies$length >= 100] = "long"
movies3 = data.frame(movies, fac_length)
ggpairs(movies3, columns = c("log_budget", "length", "year"), aes(color = fac_length))
```


```{r, include=FALSE}
# Plot budget against length faceted by year
ggplot(movies2, aes(x = length, y = log_budget)) + geom_point() +
  geom_smooth(method = "loess", span = 0.8, method.args = list(degree = 1)) +
  # facet_wrap(~ cut_number(year, n = 3), ncol = 2) +
  facet_wrap(~ fac_year) +
  labs(title = "Movie budgets vs. lengths cut by year")
```

```{r, include=FALSE}
# Plot budget against year faceted by length
ggplot(movies3, aes(x = year, y = log_budget)) + geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap(~ fac_length) +
  # facet_wrap(~ cut_number(length, n = 2), ncol = 2) +
  labs(title = "Movie budgets vs. year cut by length")
```

• Coplots cut by year follow similar trends and do not showcase anything interesting.
• Conditional plots faceted by length of movies show that the increase in budget over the years has been much sharper for long movies (more than 100 minutes) than short movies (less than 100 minutes). Hence, we need to account for this interaction in our model.
• The budget of movies seem to follow a linear trend with year, hence we will be fitting a linear model to predict log10(budget) from year.
• The dataset does not have any major outliers. Hence, we will be fitting a least squares model (no need for a robust fit).
• There does not seem to be any interaction between year and length of movies.

```{r}
# Fit two separate linear models for *short* and *long* movies to predict budget from year
fac_length = rep(NA, nrow(movies))
fac_length[movies$length < 100] = "short"
fac_length[movies$length >= 100] = "long"
movies3 = data.frame(movies, fac_length)

movies.lm = lm(log_budget ~ year * fac_length, data = movies3)
movies.lm.df = augment(movies.lm)
movies.grid = expand.grid(year = seq(1905, 2005, 1), fac_length = c("short", "long"))
movies.predict = predict(movies.lm, newdata = movies.grid)
movies.grid.df = data.frame(movies.grid, fit = as.vector(movies.predict))
```

# Solution 2

```{r}
# Visualise the model
ggplot(movies.grid.df, aes(x = year, y = fit, group = fac_length, color = fac_length)) +
  geom_line() + labs(title = "Movie budget fit conditional on length") +
  scale_color_manual(values = cb_palette)
```
While it is obvious that the budget of movies have increased over the years, this increase has been much sharper for longer movies (more than 100 minutes long) than for shorter movies (less than 100 minutes long).

```{r, include = FALSE}
# Plot the residuals
ggplot(movies.lm.df, aes(x = year, y = .resid)) + geom_smooth() +
  facet_wrap(~fac_length) + labs(title = "Residual plot")
```

