---
title: "Solution set 3"
author: "Ankit Mathur"
date: "2/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
library(tidyverse)
library(GGally)
library(broom)
cb_palette = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Solution 1

```{r, include=FALSE}
# Load the data
movies = read.csv("movie_budgets.txt", sep = " ")
```

```{r, include=FALSE}
# Transform movie budgets to log scale
movies$log_budget <- log10(movies$budget)
```

```{r, include=FALSE}
# Plot *ggpairs* for all 3 vars
ggpairs(movies, columns = c("log_budget", "length", "year"))
```

Takeaways:
  - Movie budgets and lengths seem to be correlated and might be following a linear relationship.
  - Relationship between budget and year seem to be non-linear.
  - Most of the movies in the dataset are ~90 minutes long and were released in the year 2000.
  - Interaction between year and length is not clear.

```{r, include=FALSE}
## Color trivariate plots by year
# unique(movies[order(movies$year), "year"])
# names(movies)
fac_year = rep(NA, nrow(movies))
fac_year[movies$year < 1960] = "1906-1960"
fac_year[movies$year >= 1960] = "1960-2005"
movies2 = data.frame(movies, fac_year)
ggpairs(movies2, columns = c("log_budget", "length", "year"), aes(color = fac_year))
```

```{r, include=FALSE}
# Color trivariate plots by length
fac_length = rep(NA, nrow(movies))
fac_length[movies$length < 100] = "short"
fac_length[movies$length >= 100] = "long"
movies3 = data.frame(movies, fac_length)
ggpairs(movies3, columns = c("log_budget", "length", "year"), aes(color = fac_length))
```
Short movies seem to have smaller budgets as compared to the long movies, which makes sense.


```{r, include=FALSE}
# Plot budget against length faceted by year
ggplot(movies2, aes(x = length, y = log_budget)) + geom_point() +
  geom_smooth(method = "loess", span = 0.8, method.args = list(degree = 1)) +
  # facet_wrap(~ cut_number(year, n = 3), ncol = 2) +
  facet_wrap(~ fac_year) +
  labs(title = "Movie budgets vs. lengths cut by year")
```

```{r, include=FALSE}
# Plot budget against year faceted by length
ggplot(movies3, aes(x = year, y = log_budget)) + geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap(~ fac_length) +
  # facet_wrap(~ cut_number(length, n = 2), ncol = 2) +
  labs(title = "Movie budgets vs. year cut by length")
```
Clearly, we need to model the interactions above as the slope of the left panel is higher than the right panel.

```{r}
# Fit two separate linear models for *short* and *long* movies to predict budget from year
fac_length = rep(NA, nrow(movies))
fac_length[movies$length < 100] = "short"
fac_length[movies$length >= 100] = "long"
movies3 = data.frame(movies, fac_length)

movies.lm = lm(log_budget ~ year * fac_length, data = movies3)
movies.lm.df = augment(movies.lm)
movies.grid = expand.grid(year = seq(1905, 2005, 1), fac_length = c("short", "long"))
movies.predict = predict(movies.lm, newdata = movies.grid)
movies.grid.df = data.frame(movies.grid, fit = as.vector(movies.predict))
```

```{r}
# Visualise the model
ggplot(movies.grid.df, aes(x = year, y = fit, group = fac_length, color = fac_length)) +
  geom_line() + labs(title = "Movie budget fit conditional on length") +
  scale_color_manual(values = cb_palette)
```

