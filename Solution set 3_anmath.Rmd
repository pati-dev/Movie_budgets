---
title: "Solution set 3"
author: "Ankit Mathur"
date: "2/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
library(tidyverse)
library(GGally)
library(broom)
cb_palette = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Solution 1

```{r, include=FALSE}
# Load the data
movies = read.csv("movie_budgets.txt", sep = " ")
```

```{r, include=FALSE}
# Transform movie budgets to log scale
movies$log_budget <- log10(movies$budget)
```

```{r, include=FALSE}
# Plot *ggpairs* for all 3 vars
ggpairs(movies, columns = c("log_budget", "length", "year"))
```

```{r, include=FALSE}
## Color trivariate plots by year
# unique(movies[order(movies$year), "year"])
# names(movies)
fac_year = rep(NA, nrow(movies))
fac_year[movies$year < 1960] = "1906-1960"
fac_year[movies$year >= 1960] = "1960-2005"
movies2 = data.frame(movies, fac_year)
ggpairs(movies2, columns = c("log_budget", "length", "year"), aes(color = fac_year))
```

```{r, include=FALSE}
# Color trivariate plots by length
fac_length = rep(NA, nrow(movies))
fac_length[movies$length < 90] = "short"
fac_length[(movies$length >= 90) & (movies$length < 120)] = "medium"
fac_length[movies$length >= 120] = "long"
movies3 = data.frame(movies, fac_length)
ggpairs(movies3, columns = c("log_budget", "length", "year"), aes(color = fac_length))
```


```{r, include=FALSE}
# Plot budget against length faceted by year
ggplot(movies2, aes(x = length, y = log_budget)) + geom_point() +
  geom_smooth(method = "loess", span = 0.8, method.args = list(degree = 1)) +
  # facet_wrap(~ cut_number(year, n = 3), ncol = 2) +
  facet_wrap(~ fac_year) +
  labs(title = "Movie budgets vs. lengths cut by year")
```

```{r, include = FALSE}
# Plot budget against year faceted by length
ggplot(movies3, aes(x = year, y = log_budget)) + geom_point() +
  geom_smooth(method = "lm") +
  # facet_wrap(~ fac_length) +
  facet_wrap(~ cut_number(length, n = 3), ncol = 2) +
  labs(title = "Movie budgets vs. year cut by length")
```

• Conditional plots faceted by length of movies show that while the budget of shorter movies has mostly remained flat over the years, there has been a sharp increase in budget of longer movies. Hence, we will have to account for this interaction in our model.
• Coplots cut by year follow similar trends and do not showcase anything interesting.
• The budget of movies seem to follow a linear trend with year, hence we will be fitting a linear model to predict log10(budget) from year.
• The dataset does not have any major outliers. Hence, we will be fitting a least squares model (no need for a robust fit).
• There does not seem to be any interaction between year and length of movies.

```{r}
# Fit two separate linear models for *short* and *long* movies to predict budget from year
fac_length = rep(NA, nrow(movies))
fac_length[movies$length < 90] = 0
fac_length[(movies$length >= 90) & (movies$length < 120)] = 1
fac_length[movies$length >= 120] = 2
movies3 = data.frame(movies, fac_length)

movies.lm = lm(log_budget ~ year * fac_length, data = movies3)
movies.lm.df = augment(movies.lm)
movies.grid = expand.grid(year = seq(1905, 2005, 1), fac_length = c(0, 1, 2))
movies.predict = predict(movies.lm, newdata = movies.grid)
movies.grid.df = data.frame(movies.grid, fit = as.vector(movies.predict))
movies.grid.df$fac_length <- as.factor(movies.grid.df$fac_length)
levels(movies.grid.df$fac_length) <- c("short", "medium", "long")
```

# Solution 2

```{r}
# Visualise the model
ggplot(movies.grid.df, aes(x = year, y = fit, group = fac_length, color = fac_length)) +
  geom_line() + labs(title = "log10(budget) fit conditional on length", color = "Movie length") +
  scale_color_manual(values = cb_palette)
```
While the budgets of movies shorter than 90 minutes has gone down very slightly over the years, we can see that the budgets of movies longer than 90 minutes has increased sharply over the century.

```{r, include = FALSE}
# Plot the residuals
ggplot(movies.lm.df, aes(x = year, y = .resid)) + geom_smooth() +
  facet_wrap(~fac_length) + labs(title = "Residual plot")
```

```{r}
# ggplot(movies.grid.df, aes(x = year, y = fac_length, z = fit, fill = fit)) +
#   geom_raster() + geom_contour(binwidth = 4, color = "black") + scale_fill_distiller(palette = "RdBu")
# wireframe(fit ~ year * fac_length, data=movies.grid.df, screen=list(z=30, x=-60, y=0))
wireframe(fit ~ year * fac_length, data=movies.grid.df, screen=list(z=-70, x=-90, y=90))
```
The 3D wireframe plot above confirms our observation that the budget for *long* movies has gone up at a much higher rate than that of the *medium* budget movies over the years, whereas the budget for *short* movies has remained pretty much constant.
